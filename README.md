# Temporal Python Workflow Demo: Fetch, Transform, and Retry

[![Temporal](https://img.shields.io/badge/temporal.io-framework-blue)](https://temporal.io/)

This project demonstrates a small Temporal workflow (Python SDK) that fetches a list of todos from an external API, applies a transformation (marks certain todos completed), and returns the result to the client.

The workflow performs the following steps:
1. Fetch todos from `https://jsonplaceholder.typicode.com/todos` (activity: `fetch_todos`).
2. Transform todos (activity: `transform_todos`) — mark tasks for `userId == 2` as `completed`.
3. Return the transformed list to the client, which saves it to an in-memory DB and persists to `tasks_dump.json`.

A demo feature: `fetch_todos` simulates a recoverable failure on the first attempt so you can observe Temporal's automatic retry behavior.

---

## Features

- Multi-step workflow using Temporal Workflows and Activities
- Demonstrates automatic retries using a `RetryPolicy`
- Simple in-memory store with an optional dump to `tasks_dump.json` for inspection

---

## Prerequisites

- Python 3.8+
- Temporal Server running locally (recommended for development)

Start a local Temporal server with Docker (example):

```powershell
# on Windows PowerShell
docker run -d -p 7233:7233 --name temporal temporalio/auto-setup:latest
```

Or using the Temporal CLI:

```powershell
temporal server start-dev
```

---

## Setup

Clone and install:

```bash
git clone https://github.com/chizzyedoka/temporal-workflow-task.git
cd temporal-workflow-task
python -m venv venv
# Windows
.\venv\Scripts\activate
# macOS / Linux
# source venv/bin/activate
pip install -r requirements.txt
```

---

## Run the demo

This demo uses two processes: a Worker and a Client. Start them in separate terminals.

Terminal 1 — start the Worker:

```cmd
python worker.py
```

You should see the worker start and listen for tasks:

```
Worker started; listening for tasks...
```

Terminal 2 — run the Client to start the workflow:

```cmd
python client_run.py
```

The client will block until the workflow completes (including any retries). When successful, the client will persist the transformed tasks to `tasks_dump.json` and print a short summary.

---

## Expected output

Worker (Terminal 1) will show the retry in action for `fetch_todos` (Attempt 1 failing, Attempt 2 succeeding), followed by `transform_todos` executing.

Client (Terminal 2) prints a completion message and summary statistics and the database dump will contain the transformed tasks (including tasks for `userId == 2` marked completed).

---

## Project structure

```
.
├── activities.py       # Activity implementations (fetch_todos, transform_todos)
├── client_run.py       # Starts and waits for workflow execution
├── requirements.txt    # Python dependencies
├── store.py            # Simple in-memory database utility
├── tasks_dump.json     # Optional persisted DB file (generated by client)
├── worker.py           # Temporal worker that executes activities
└── workflows.py        # Workflow definition that orchestrates activities
```

---

If you'd like, I can also add a tiny troubleshooting section (worker registration checks, debugging tips) or add a quick PowerShell script to start both processes. Let me know which you'd prefer.

```
INFO:root:Worker started; listening for tasks...
INFO:temporalio.workflow:Starting activity: fetch_todos
INFO:temporalio.activity:Executing fetch_todos, attempt 1
WARNING:temporalio.activity:Simulating API failure on attempt 1...
ERROR:temporalio.worker:Completing activity as failed
Traceback (most recent call last):
  ...
RuntimeError: Simulated API failure

# <-- Worker waits 1s (from RetryPolicy) -->

INFO:temporalio.activity:Executing fetch_todos, attempt 2
INFO:temporalio.activity:Attempt 2 (or later) successful. Fetching data...
INFO:temporalio.workflow:Activity fetch_todos completed

INFO:temporalio.workflow:Starting activity: transform_todos
INFO:temporalio.activity:Transforming 200 todos
INFO:temporalio.activity:Modified 20 todos for userId 2
INFO:temporalio.workflow:Activity transform_todos completed
```

### In your Client Terminal (Terminal 2)
The client script will wait for the entire workflow to successfully complete (including the retry) and then print the final result, proving the transformation worked.

```
✅ Workflow completed successfully!

 Total tasks saved in database: 200

 Tasks for userId 2: 20 total, 20 completed

First 5 tasks from database:
   - ID 1: delectus aut autem (Completed: False, User: 1)
   - ID 2: quis ut nam facilis ... (Completed: False, User: 1)
   - ID 3: fugiat veniam minus (Completed: False, User: 1)
   - ID 4: et porro tempora (Completed: True, User: 1)
   - ID 5: laboriosam mollitia ... (Completed: False, User: 1)

Sample tasks from userId 2:
   - ID 21: ... (Completed: True)
   - ID 22: ... (Completed: True)
   - ID 23: ... (Completed: True)
```

**Note**: The <i>(Completed: True)</i> for <i>userId 2</i> tasks confirms the transformation was successful.

### Project Structure
```
.
├── activities.py       # Defines the business logic (fetch_todos, transform_todos)
├── client_run.py       # Starts the workflow execution
├── requirements.txt    # Python dependencies
├── store.py            # Simple in-memory database utility
├── worker.py           # Runs the Temporal Worker to execute tasks
└── workflows.py        # Defines the workflow orchestration logic
```
